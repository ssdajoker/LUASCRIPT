{
  "name": "runtime.lua",
  "path": "runtime/runtime.lua",
  "sha": "3c7f2ccd62aa4ddaf18053a57db31462dae652d0",
  "size": 30731,
  "url": "https://api.github.com/repos/ssdajoker/LUASCRIPT/contents/runtime/runtime.lua?ref=fix/runtime-compat-phase1B",
  "html_url": "https://github.com/ssdajoker/LUASCRIPT/blob/fix/runtime-compat-phase1B/runtime/runtime.lua",
  "git_url": "https://api.github.com/repos/ssdajoker/LUASCRIPT/git/blobs/5416866255403d69860f82dd7e3d955ad6238685",
  "download_url": "https://raw.githubusercontent.com/ssdajoker/LUASCRIPT/fix/runtime-compat-phase1B/runtime/runtime.lua",
  "type": "file",
  "content": "LS0gTFVBU0NSSVBUIFJ1bnRpbWUgTGlicmFyeQotLSBQcm92aWRlcyBKYXZhU2NyaXB0LWNvbXBhdGlibGUgZnVuY3Rpb25zIGZvciBMdWEgZW52aXJvbm1lbnQKLS0gUGhhc2UgMUI6IENyaXRpY2FsIHJ1bnRpbWUgY29tcGF0aWJpbGl0eSBmaXhlcwpsb2NhbCBydW50aW1lID0ge30KLS0gQ29uc29sZSBvYmplY3QgZm9yIEphdmFTY3JpcHQgY29tcGF0aWJpbGl0eQpydW50aW1lLmNvbnNvbGUgPSB7fQpmdW5jdGlvbiBydW50aW1lLmNvbnNvbGUubG9nKC4uLikKICAgIGxvY2FsIGFyZ3MgPSB7Li4ufQogICAgbG9jYWwgb3V0cHV0ID0ge30KICAgIGZvciBpLCB2IGluIGlwYWlycyhhcmdzKSBkbwogICAgICAgIGlmIHR5cGUodikgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgIG91dHB1dFtpXSA9IHJ1bnRpbWUuSlNPTi5zdHJpbmdpZnkodikKICAgICAgICBlbHNlaWYgdHlwZSh2KSA9PSAibmlsIiB0aGVuCiAgICAgICAgICAgIG91dHB1dFtpXSA9ICJuaWwiCiAgICAgICAgZWxzZWlmIHR5cGUodikgPT0gImJvb2xlYW4iIHRoZW4KICAgICAgICAgICAgb3V0cHV0W2ldID0gdG9zdHJpbmcodikKICAgICAgICBlbHNlCiAgICAgICAgICAgIG91dHB1dFtpXSA9IHRvc3RyaW5nKHYpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHByaW50KHRhYmxlLmNvbmNhdChvdXRwdXQsICIgIikpCmVuZApmdW5jdGlvbiBydW50aW1lLmNvbnNvbGUuZXJyb3IoLi4uKQogICAgaW8uc3RkZXJyOndyaXRlKCJFUlJPUjogIikKICAgIHJ1bnRpbWUuY29uc29sZS5sb2coLi4uKQplbmQKZnVuY3Rpb24gcnVudGltZS5jb25zb2xlLndhcm4oLi4uKQogICAgaW8uc3RkZXJyOndyaXRlKCJXQVJOSU5HOiAiKQogICAgcnVudGltZS5jb25zb2xlLmxvZyguLi4pCmVuZApmdW5jdGlvbiBydW50aW1lLmNvbnNvbGUuaW5mbyguLi4pCiAgICBpby5zdGRlcnI6d3JpdGUoIklORk86ICIpCiAgICBydW50aW1lLmNvbnNvbGUubG9nKC4uLikKZW5kCi0tIEpTT04gb2JqZWN0IGZvciBKYXZhU2NyaXB0IGNvbXBhdGliaWxpdHkKcnVudGltZS5KU09OID0ge30KZnVuY3Rpb24gcnVudGltZS5KU09OLnN0cmluZ2lmeShvYmosIGluZGVudCkKICAgIGxvY2FsIGZ1bmN0aW9uIHNlcmlhbGl6ZShvLCBsZXZlbCkKICAgICAgICBsZXZlbCA9IGxldmVsIG9yIDAKICAgICAgICBsb2NhbCBpbmRlbnRfc3RyID0gaW5kZW50IGFuZCBzdHJpbmcucmVwKCIgICIsIGxldmVsKSBvciAiIgogICAgICAgIGxvY2FsIG5leHRfaW5kZW50X3N0ciA9IGluZGVudCBhbmQgc3RyaW5nLnJlcCgiICAiLCBsZXZlbCArIDEpIG9yICIiCiAgICAgICAgaWYgdHlwZShvKSA9PSAibmlsIiB0aGVuCiAgICAgICAgICAgIHJldHVybiAibnVsbCIKICAgICAgICBlbHNlaWYgdHlwZShvKSA9PSAiYm9vbGVhbiIgdGhlbgogICAgICAgICAgICByZXR1cm4gdG9zdHJpbmcobykKICAgICAgICBlbHNlaWYgdHlwZShvKSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgICAgIHJldHVybiB0b3N0cmluZyhvKQogICAgICAgIGVsc2VpZiB0eXBlKG8pID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgcmV0dXJuICciJyAuLiBvOmdzdWIoJyInLCAnXFwiJykgLi4gJyInCiAgICAgICAgZWxzZWlmIHR5cGUobykgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGlzX2FycmF5ID0gdHJ1ZQogICAgICAgICAgICBsb2NhbCBtYXhfaW5kZXggPSAwCiAgICAgICAgICAgIC0tIENoZWNrIGlmIHRhYmxlIGlzIGFycmF5LWxpa2UKICAgICAgICAgICAgZm9yIGssIF8gaW4gcGFpcnMobykgZG8KICAgICAgICAgICAgICAgIGlmIHR5cGUoaykgfj0gIm51bWJlciIgb3IgayA8PSAwIG9yIGsgfj0gbWF0aC5mbG9vcihrKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaXNfYXJyYXkgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIG1heF9pbmRleCA9IG1hdGgubWF4KG1heF9pbmRleCwgaykKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGlzX2FycmF5IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFyciA9IHt9CiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIG1heF9pbmRleCBkbwogICAgICAgICAgICAgICAgICAgIGFycltpXSA9IHNlcmlhbGl6ZShvW2ldLCBsZXZlbCArIDEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGluZGVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJbXG4iIC4uIG5leHRfaW5kZW50X3N0ciAuLgogICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5jb25jYXQoYXJyLCAiLFxuIiAuLiBuZXh0X2luZGVudF9zdHIpIC4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbiIgLi4gaW5kZW50X3N0ciAuLiAiXSIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlsiIC4uIHRhYmxlLmNvbmNhdChhcnIsICIsIikgLi4gIl0iCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgb2JqX3BhcnRzID0ge30KICAgICAgICAgICAgICAgIGZvciBrLCB2IGluIHBhaXJzKG8pIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwga2V5ID0gdHlwZShrKSA9PSAic3RyaW5nIiBhbmQgKCciJyAuLiBrIC4uICciJykgb3IgdG9zdHJpbmcoaykKICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQob2JqX3BhcnRzLCBrZXkgLi4gIjoiIC4uIChpbmRlbnQgYW5kICIgIiBvciAiIikgLi4gc2VyaWFsaXplKHYsIGxldmVsICsgMSkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGluZGVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ7XG4iIC4uIG5leHRfaW5kZW50X3N0ciAuLgogICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5jb25jYXQob2JqX3BhcnRzLCAiLFxuIiAuLiBuZXh0X2luZGVudF9zdHIpIC4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbiIgLi4gaW5kZW50X3N0ciAuLiAifSIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInsiIC4uIHRhYmxlLmNvbmNhdChvYmpfcGFydHMsICIsIikgLi4gIn0iCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gJyInIC4uIHRvc3RyaW5nKG8pIC4uICciJwogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gc2VyaWFsaXplKG9iaikKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuSlNPTi5wYXJzZShqc29uX3N0cikKICAgIC0tIFNpbXBsZSBKU09OIHBhcnNlciAoYmFzaWMgaW1wbGVtZW50YXRpb24pCiAgICAtLSBGb3IgcHJvZHVjdGlvbiB1c2UsIGNvbnNpZGVyIHVzaW5nIGEgcHJvcGVyIEpTT04gbGlicmFyeQogICAgbG9jYWwgZnVuY3Rpb24gcGFyc2VfdmFsdWUoc3RyLCBwb3MpCiAgICAgICAgcG9zID0gcG9zIG9yIDEKICAgICAgICAtLSBTa2lwIHdoaXRlc3BhY2UKICAgICAgICB3aGlsZSBwb3MgPD0gI3N0ciBhbmQgc3RyOnN1Yihwb3MsIHBvcyk6bWF0Y2goIiVzIikgZG8KICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgIGVuZAogICAgICAgIGlmIHBvcyA+ICNzdHIgdGhlbgogICAgICAgICAgICByZXR1cm4gbmlsLCBwb3MKICAgICAgICBlbmQKICAgICAgICBsb2NhbCBjaGFyID0gc3RyOnN1Yihwb3MsIHBvcykKICAgICAgICBpZiBjaGFyID09ICciJyB0aGVuCiAgICAgICAgICAgIC0tIFBhcnNlIHN0cmluZwogICAgICAgICAgICBsb2NhbCBlbmRfcG9zID0gcG9zICsgMQogICAgICAgICAgICB3aGlsZSBlbmRfcG9zIDw9ICNzdHIgYW5kIHN0cjpzdWIoZW5kX3BvcywgZW5kX3Bvcykgfj0gJyInIGRvCiAgICAgICAgICAgICAgICBpZiBzdHI6c3ViKGVuZF9wb3MsIGVuZF9wb3MpID09ICdcXCcgdGhlbgogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSBlbmRfcG9zICsgMgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGVuZF9wb3MgPSBlbmRfcG9zICsgMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gc3RyOnN1Yihwb3MgKyAxLCBlbmRfcG9zIC0gMSksIGVuZF9wb3MgKyAxCiAgICAgICAgZWxzZWlmIGNoYXIgPT0gJ3snIHRoZW4KICAgICAgICAgICAgLS0gUGFyc2Ugb2JqZWN0CiAgICAgICAgICAgIGxvY2FsIG9iaiA9IHt9CiAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgLS0gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgICAgIHdoaWxlIHBvcyA8PSAjc3RyIGFuZCBzdHI6c3ViKHBvcywgcG9zKTptYXRjaCgiJXMiKSBkbwogICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgcG9zIDw9ICNzdHIgYW5kIHN0cjpzdWIocG9zLCBwb3MpID09ICd9JyB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLCBwb3MgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB3aGlsZSBwb3MgPD0gI3N0ciBkbwogICAgICAgICAgICAgICAgbG9jYWwga2V5LCBuZXdfcG9zID0gcGFyc2VfdmFsdWUoc3RyLCBwb3MpCiAgICAgICAgICAgICAgICBwb3MgPSBuZXdfcG9zCiAgICAgICAgICAgICAgICAtLSBTa2lwIHdoaXRlc3BhY2UgYW5kIGNvbG9uCiAgICAgICAgICAgICAgICB3aGlsZSBwb3MgPD0gI3N0ciBhbmQgKHN0cjpzdWIocG9zLCBwb3MpOm1hdGNoKCIlcyIpIG9yIHN0cjpzdWIocG9zLCBwb3MpID09ICc6JykgZG8KICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlCiAgICAgICAgICAgICAgICB2YWx1ZSwgcG9zID0gcGFyc2VfdmFsdWUoc3RyLCBwb3MpCiAgICAgICAgICAgICAgICBvYmpba2V5XSA9IHZhbHVlCiAgICAgICAgICAgICAgICAtLSBTa2lwIHdoaXRlc3BhY2UKICAgICAgICAgICAgICAgIHdoaWxlIHBvcyA8PSAjc3RyIGFuZCBzdHI6c3ViKHBvcywgcG9zKTptYXRjaCgiJXMiKSBkbwogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcG9zIDw9ICNzdHIgYW5kIHN0cjpzdWIocG9zLCBwb3MpID09ICcsJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgZWxzZWlmIHBvcyA8PSAjc3RyIGFuZCBzdHI6c3ViKHBvcywgcG9zKSA9PSAnfScgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmosIHBvcyArIDEKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gb2JqLCBwb3MKICAgICAgICBlbHNlaWYgY2hhciA9PSAnWycgdGhlbgogICAgICAgICAgICAtLSBQYXJzZSBhcnJheQogICAgICAgICAgICBsb2NhbCBhcnIgPSB7fQogICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgIGxvY2FsIGluZGV4ID0gMQogICAgICAgICAgICAtLSBTa2lwIHdoaXRlc3BhY2UKICAgICAgICAgICAgd2hpbGUgcG9zIDw9ICNzdHIgYW5kIHN0cjpzdWIocG9zLCBwb3MpOm1hdGNoKCIlcyIpIGRvCiAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBwb3MgPD0gI3N0ciBhbmQgc3RyOnN1Yihwb3MsIHBvcykgPT0gJ10nIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBhcnIsIHBvcyArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHdoaWxlIHBvcyA8PSAjc3RyIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB2YWx1ZQogICAgICAgICAgICAgICAgdmFsdWUsIHBvcyA9IHBhcnNlX3ZhbHVlKHN0ciwgcG9zKQogICAgICAgICAgICAgICAgYXJyW2luZGV4XSA9IHZhbHVlCiAgICAgICAgICAgICAgICBpbmRleCA9IGluZGV4ICsgMQogICAgICAgICAgICAgICAgLS0gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgICAgICAgICB3aGlsZSBwb3MgPD0gI3N0ciBhbmQgc3RyOnN1Yihwb3MsIHBvcyk6bWF0Y2goIiVzIikgZG8KICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBvcyA8PSAjc3RyIGFuZCBzdHI6c3ViKHBvcywgcG9zKSA9PSAnLCcgdGhlbgogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgIGVsc2VpZiBwb3MgPD0gI3N0ciBhbmQgc3RyOnN1Yihwb3MsIHBvcykgPT0gJ10nIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJyLCBwb3MgKyAxCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIGFyciwgcG9zCiAgICAgICAgZWxzZWlmIGNoYXI6bWF0Y2goIlslZCUtXSIpIHRoZW4KICAgICAgICAgICAgLS0gUGFyc2UgbnVtYmVyCiAgICAgICAgICAgIGxvY2FsIGVuZF9wb3MgPSBwb3MKICAgICAgICAgICAgd2hpbGUgZW5kX3BvcyA8PSAjc3RyIGFuZCBzdHI6c3ViKGVuZF9wb3MsIGVuZF9wb3MpOm1hdGNoKCJbJWQlLiUtZUUrXSIpIGRvCiAgICAgICAgICAgICAgICBlbmRfcG9zID0gZW5kX3BvcyArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiB0b251bWJlcihzdHI6c3ViKHBvcywgZW5kX3BvcyAtIDEpKSwgZW5kX3BvcwogICAgICAgIGVsc2VpZiBzdHI6c3ViKHBvcywgcG9zICsgMykgPT0gInRydWUiIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUsIHBvcyArIDQKICAgICAgICBlbHNlaWYgc3RyOnN1Yihwb3MsIHBvcyArIDQpID09ICJmYWxzZSIgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UsIHBvcyArIDUKICAgICAgICBlbHNlaWYgc3RyOnN1Yihwb3MsIHBvcyArIDMpID09ICJudWxsIiB0aGVuCiAgICAgICAgICAgIHJldHVybiBuaWwsIHBvcyArIDQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gbmlsLCBwb3MKICAgIGVuZAogICAgbG9jYWwgcmVzdWx0LCBfID0gcGFyc2VfdmFsdWUoanNvbl9zdHIpCiAgICByZXR1cm4gcmVzdWx0CmVuZApsb2NhbCBmdW5jdGlvbiBwYWNrX2FyZ3VtZW50cyguLi4pCiAgICByZXR1cm4geyBuID0gc2VsZWN0KCIjIiwgLi4uKSwgLi4uIH0KZW5kCgpsb2NhbCBmdW5jdGlvbiBlbnN1cmVfbnVtZXJpYyh2YWx1ZSwgY29udGV4dCkKICAgIGlmIHR5cGUodmFsdWUpID09ICJudW1iZXIiIHRoZW4KICAgICAgICByZXR1cm4gdmFsdWUKICAgIGVuZAoKICAgIGxvY2FsIGNvbnZlcnRlZCA9IHRvbnVtYmVyKHZhbHVlKQogICAgaWYgY29udmVydGVkID09IG5pbCB0aGVuCiAgICAgICAgZXJyb3Ioc3RyaW5nLmZvcm1hdCgiJXM6IGV4cGVjdGVkIG51bWVyaWMgdmFsdWUsIGdvdCAlcyIsIGNvbnRleHQsIHR5cGUodmFsdWUpKSkKICAgIGVuZAoKICAgIHJldHVybiBjb252ZXJ0ZWQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVfc3VtbWF0aW9uX2ltcGwoKQogICAgcmV0dXJuIGZ1bmN0aW9uKC4uLikKICAgICAgICBsb2NhbCBhcmdzID0gcGFja19hcmd1bWVudHMoLi4uKQogICAgICAgIGlmIGFyZ3MubiA9PSAwIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uOiBleHBlY3RlZCBhdCBsZWFzdCBvbmUgYXJndW1lbnQiKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmaXJzdCA9IGFyZ3NbMV0KCiAgICAgICAgaWYgdHlwZShmaXJzdCkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgIC0tIFN1bW1hdGlvbiBvdmVyIGEgY29sbGVjdGlvbgogICAgICAgICAgICBsb2NhbCBjYWxsYmFjayA9IHR5cGUoYXJnc1syXSkgPT0gImZ1bmN0aW9uIiBhbmQgYXJnc1syXSBvciBuaWwKICAgICAgICAgICAgbG9jYWwgdG90YWwgPSAwCgogICAgICAgICAgICBmb3IgaW5kZXggPSAxLCAjZmlyc3QgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gZmlyc3RbaW5kZXhdCiAgICAgICAgICAgICAgICBpZiBjYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGZpcnN0KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0b3RhbCA9IHRvdGFsICsgZW5zdXJlX251bWVyaWModmFsdWUsICJtYXRoLnN1bW1hdGlvbiBjYWxsYmFjayByZXN1bHQiKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB0b3RhbAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBsb3dlcgogICAgICAgIGxvY2FsIHVwcGVyCiAgICAgICAgbG9jYWwgc3RlcAogICAgICAgIGxvY2FsIGNhbGxiYWNrCgogICAgICAgIGlmIHR5cGUoZmlyc3QpID09ICJmdW5jdGlvbiIgYW5kIGFyZ3MubiA+PSAzIGFuZCB0eXBlKGFyZ3NbMl0pID09ICJudW1iZXIiIGFuZCB0eXBlKGFyZ3NbM10pID09ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgY2FsbGJhY2sgPSBmaXJzdAogICAgICAgICAgICBsb3dlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbMl0sICJtYXRoLnN1bW1hdGlvbiBsb3dlciIpCiAgICAgICAgICAgIHVwcGVyID0gZW5zdXJlX251bWVyaWMoYXJnc1szXSwgIm1hdGguc3VtbWF0aW9uIHVwcGVyIikKICAgICAgICAgICAgc3RlcCA9IGFyZ3MubiA+PSA0IGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzRdLCAibWF0aC5zdW1tYXRpb24gc3RlcCIpIG9yIG5pbAogICAgICAgIGVsc2VpZiBhcmdzLm4gPj0gNCBhbmQgdHlwZShhcmdzWzRdKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgY2FsbGJhY2sgPSBhcmdzWzRdCiAgICAgICAgICAgIGxvd2VyID0gZW5zdXJlX251bWVyaWMoYXJnc1syXSwgIm1hdGguc3VtbWF0aW9uIGxvd2VyIikKICAgICAgICAgICAgdXBwZXIgPSBlbnN1cmVfbnVtZXJpYyhhcmdzWzNdLCAibWF0aC5zdW1tYXRpb24gdXBwZXIiKQogICAgICAgICAgICBzdGVwID0gYXJncy5uID49IDUgYW5kIGVuc3VyZV9udW1lcmljKGFyZ3NbNV0sICJtYXRoLnN1bW1hdGlvbiBzdGVwIikgb3IgbmlsCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb3dlciA9IGVuc3VyZV9udW1lcmljKGZpcnN0LCAibWF0aC5zdW1tYXRpb24gbG93ZXIiKQogICAgICAgICAgICB1cHBlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbMl0sICJtYXRoLnN1bW1hdGlvbiB1cHBlciIpCgogICAgICAgICAgICBpZiBhcmdzLm4gPj0gMyBhbmQgdHlwZShhcmdzWzNdKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gYXJnc1szXQogICAgICAgICAgICAgICAgc3RlcCA9IGFyZ3MubiA+PSA0IGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzRdLCAibWF0aC5zdW1tYXRpb24gc3RlcCIpIG9yIG5pbAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzdGVwID0gYXJncy5uID49IDMgYW5kIGVuc3VyZV9udW1lcmljKGFyZ3NbM10sICJtYXRoLnN1bW1hdGlvbiBzdGVwIikgb3IgbmlsCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHR5cGUoYXJnc1s0XSkgPT0gImZ1bmN0aW9uIiBhbmQgYXJnc1s0XSBvciBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgb3IgZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgIGVuZAoKICAgICAgICBpZiB0eXBlKGNhbGxiYWNrKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uOiBleHBlY3RlZCBjYWxsYmFjayBmdW5jdGlvbiIpCiAgICAgICAgZW5kCgogICAgICAgIHN0ZXAgPSBzdGVwIG9yIChsb3dlciA8PSB1cHBlciBhbmQgMSBvciAtMSkKICAgICAgICBpZiBzdGVwID09IDAgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5zdW1tYXRpb246IHN0ZXAgbXVzdCBiZSBub24temVybyIpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHRvdGFsID0gMAogICAgICAgIGxvY2FsIGl0ZXJhdGlvbiA9IDAKCiAgICAgICAgZm9yIHZhbHVlID0gbG93ZXIsIHVwcGVyLCBzdGVwIGRvCiAgICAgICAgICAgIGxvY2FsIHJlc3VsdCA9IGNhbGxiYWNrKHZhbHVlLCBpdGVyYXRpb24pCiAgICAgICAgICAgIHRvdGFsID0gdG90YWwgKyBlbnN1cmVfbnVtZXJpYyhyZXN1bHQsICJtYXRoLnN1bW1hdGlvbiBjYWxsYmFjayByZXN1bHQiKQogICAgICAgICAgICBpdGVyYXRpb24gPSBpdGVyYXRpb24gKyAxCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiB0b3RhbAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gY3JlYXRlX3Byb2R1Y3RfaW1wbCgpCiAgICByZXR1cm4gZnVuY3Rpb24oLi4uKQogICAgICAgIGxvY2FsIGFyZ3MgPSBwYWNrX2FyZ3VtZW50cyguLi4pCiAgICAgICAgaWYgYXJncy5uID09IDAgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5wcm9kdWN0OiBleHBlY3RlZCBhdCBsZWFzdCBvbmUgYXJndW1lbnQiKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmaXJzdCA9IGFyZ3NbMV0KCiAgICAgICAgLS0gUHJvZHVjdCBvdmVyIGEgY29sbGVjdGlvbgogICAgICAgIGlmIHR5cGUoZmlyc3QpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICBsb2NhbCBjYWxsYmFjayA9IHR5cGUoYXJnc1syXSkgPT0gImZ1bmN0aW9uIiBhbmQgYXJnc1syXSBvciBuaWwKICAgICAgICAgICAgbG9jYWwgdG90YWwgPSAxCgogICAgICAgICAgICBmb3IgaW5kZXggPSAxLCAjZmlyc3QgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gZmlyc3RbaW5kZXhdCiAgICAgICAgICAgICAgICBpZiBjYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIGZpcnN0KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0b3RhbCA9IHRvdGFsICogZW5zdXJlX251bWVyaWModmFsdWUsICJtYXRoLnByb2R1Y3QgY2FsbGJhY2sgcmVzdWx0IikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gdG90YWwKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbG93ZXIKICAgICAgICBsb2NhbCB1cHBlcgogICAgICAgIGxvY2FsIHN0ZXAKICAgICAgICBsb2NhbCBjYWxsYmFjawoKICAgICAgICBpZiB0eXBlKGZpcnN0KSA9PSAiZnVuY3Rpb24iIGFuZCBhcmdzLm4gPj0gMyBhbmQgdHlwZShhcmdzWzJdKSA9PSAibnVtYmVyIiBhbmQgdHlwZShhcmdzWzNdKSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgICAgIGNhbGxiYWNrID0gZmlyc3QKICAgICAgICAgICAgbG93ZXIgPSBlbnN1cmVfbnVtZXJpYyhhcmdzWzJdLCAibWF0aC5wcm9kdWN0IGxvd2VyIikKICAgICAgICAgICAgdXBwZXIgPSBlbnN1cmVfbnVtZXJpYyhhcmdzWzNdLCAibWF0aC5wcm9kdWN0IHVwcGVyIikKICAgICAgICAgICAgc3RlcCA9IGFyZ3MubiA+PSA0IGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzRdLCAibWF0aC5wcm9kdWN0IHN0ZXAiKSBvciBuaWwKICAgICAgICBlbHNlaWYgYXJncy5uID49IDQgYW5kIHR5cGUoYXJnc1s0XSkgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIGNhbGxiYWNrID0gYXJnc1s0XQogICAgICAgICAgICBsb3dlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbMl0sICJtYXRoLnByb2R1Y3QgbG93ZXIiKQogICAgICAgICAgICB1cHBlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbM10sICJtYXRoLnByb2R1Y3QgdXBwZXIiKQogICAgICAgICAgICBzdGVwID0gYXJncy5uID49IDUgYW5kIGVuc3VyZV9udW1lcmljKGFyZ3NbNV0sICJtYXRoLnByb2R1Y3Qgc3RlcCIpIG9yIG5pbAogICAgICAgIGVsc2UKICAgICAgICAgICAgbG93ZXIgPSBlbnN1cmVfbnVtZXJpYyhmaXJzdCwgIm1hdGgucHJvZHVjdCBsb3dlciIpCiAgICAgICAgICAgIHVwcGVyID0gZW5zdXJlX251bWVyaWMoYXJnc1syXSwgIm1hdGgucHJvZHVjdCB1cHBlciIpCgogICAgICAgICAgICBpZiBhcmdzLm4gPj0gMyBhbmQgdHlwZShhcmdzWzNdKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gYXJnc1szXQogICAgICAgICAgICAgICAgc3RlcCA9IGFyZ3MubiA+PSA0IGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzRdLCAibWF0aC5wcm9kdWN0IHN0ZXAiKSBvciBuaWwKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RlcCA9IGFyZ3MubiA+PSAzIGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzNdLCAibWF0aC5wcm9kdWN0IHN0ZXAiKSBvciBuaWwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gdHlwZShhcmdzWzRdKSA9PSAiZnVuY3Rpb24iIGFuZCBhcmdzWzRdIG9yIG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayBvciBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgZW5kCgogICAgICAgIGlmIHR5cGUoY2FsbGJhY2spIH49ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5wcm9kdWN0OiBleHBlY3RlZCBjYWxsYmFjayBmdW5jdGlvbiIpCiAgICAgICAgZW5kCgogICAgICAgIHN0ZXAgPSBzdGVwIG9yIChsb3dlciA8PSB1cHBlciBhbmQgMSBvciAtMSkKICAgICAgICBpZiBzdGVwID09IDAgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5wcm9kdWN0OiBzdGVwIG11c3QgYmUgbm9uLXplcm8iKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCB0b3RhbCA9IDEKICAgICAgICBsb2NhbCBpdGVyYXRpb24gPSAwCgogICAgICAgIGZvciB2YWx1ZSA9IGxvd2VyLCB1cHBlciwgc3RlcCBkbwogICAgICAgICAgICBsb2NhbCByZXN1bHQgPSBjYWxsYmFjayh2YWx1ZSwgaXRlcmF0aW9uKQogICAgICAgICAgICB0b3RhbCA9IHRvdGFsICogZW5zdXJlX251bWVyaWMocmVzdWx0LCAibWF0aC5wcm9kdWN0IGNhbGxiYWNrIHJlc3VsdCIpCiAgICAgICAgICAgIGl0ZXJhdGlvbiA9IGl0ZXJhdGlvbiArIDEKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIHRvdGFsCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVfaW50ZWdyYWxfaW1wbCgpCiAgICByZXR1cm4gZnVuY3Rpb24oLi4uKQogICAgICAgIGxvY2FsIGFyZ3MgPSBwYWNrX2FyZ3VtZW50cyguLi4pCiAgICAgICAgaWYgYXJncy5uID09IDAgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5pbnRlZ3JhbDogZXhwZWN0ZWQgYXQgbGVhc3Qgb25lIGFyZ3VtZW50IikKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZmlyc3QgPSBhcmdzWzFdCgogICAgICAgIC0tIE51bWVyaWNhbCBpbnRlZ3JhdGlvbiBvdmVyIGRpc2NyZXRlIHBvaW50cyB1c2luZyB0aGUgdHJhcGV6b2lkYWwgcnVsZQogICAgICAgIGlmIHR5cGUoZmlyc3QpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICBpZiAjZmlyc3QgPCAyIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgYXJlYSA9IDAKICAgICAgICAgICAgZm9yIGkgPSAxLCAjZmlyc3QgLSAxIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBzZWdtZW50X3N0YXJ0ID0gZmlyc3RbaV0KICAgICAgICAgICAgICAgIGxvY2FsIHNlZ21lbnRfZW5kID0gZmlyc3RbaSArIDFdCgogICAgICAgICAgICAgICAgaWYgdHlwZShzZWdtZW50X3N0YXJ0KSB+PSAidGFibGUiIG9yIHR5cGUoc2VnbWVudF9lbmQpIH49ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIGVycm9yKCJtYXRoLmludGVncmFsOiBleHBlY3RlZCB0YWJsZSBvZiB7eCwgeX0gcG9pbnRzIikKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIHgwID0gZW5zdXJlX251bWVyaWMoc2VnbWVudF9zdGFydFsxXSwgIm1hdGguaW50ZWdyYWwgcG9pbnQgeDAiKQogICAgICAgICAgICAgICAgbG9jYWwgeTAgPSBlbnN1cmVfbnVtZXJpYyhzZWdtZW50X3N0YXJ0WzJdLCAibWF0aC5pbnRlZ3JhbCBwb2ludCB5MCIpCiAgICAgICAgICAgICAgICBsb2NhbCB4MSA9IGVuc3VyZV9udW1lcmljKHNlZ21lbnRfZW5kWzFdLCAibWF0aC5pbnRlZ3JhbCBwb2ludCB4MSIpCiAgICAgICAgICAgICAgICBsb2NhbCB5MSA9IGVuc3VyZV9udW1lcmljKHNlZ21lbnRfZW5kWzJdLCAibWF0aC5pbnRlZ3JhbCBwb2ludCB5MSIpCgogICAgICAgICAgICAgICAgYXJlYSA9IGFyZWEgKyAoKHkwICsgeTEpIC8gMikgKiAoeDEgLSB4MCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gYXJlYQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBpbnRlZ3JhbmQKICAgICAgICBsb2NhbCBsb3dlcgogICAgICAgIGxvY2FsIHVwcGVyCiAgICAgICAgbG9jYWwgc2VnbWVudHMKCiAgICAgICAgaWYgdHlwZShmaXJzdCkgPT0gImZ1bmN0aW9uIiBhbmQgYXJncy5uID49IDMgYW5kIHR5cGUoYXJnc1syXSkgPT0gIm51bWJlciIgYW5kIHR5cGUoYXJnc1szXSkgPT0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBpbnRlZ3JhbmQgPSBmaXJzdAogICAgICAgICAgICBsb3dlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbMl0sICJtYXRoLmludGVncmFsIGxvd2VyIikKICAgICAgICAgICAgdXBwZXIgPSBlbnN1cmVfbnVtZXJpYyhhcmdzWzNdLCAibWF0aC5pbnRlZ3JhbCB1cHBlciIpCiAgICAgICAgICAgIHNlZ21lbnRzID0gYXJncy5uID49IDQgYW5kIGVuc3VyZV9udW1lcmljKGFyZ3NbNF0sICJtYXRoLmludGVncmFsIHNlZ21lbnRzIikgb3IgbmlsCiAgICAgICAgZWxzZWlmIGFyZ3MubiA+PSA0IGFuZCB0eXBlKGFyZ3NbNF0pID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICBpbnRlZ3JhbmQgPSBhcmdzWzRdCiAgICAgICAgICAgIGxvd2VyID0gZW5zdXJlX251bWVyaWMoYXJnc1syXSwgIm1hdGguaW50ZWdyYWwgbG93ZXIiKQogICAgICAgICAgICB1cHBlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbM10sICJtYXRoLmludGVncmFsIHVwcGVyIikKICAgICAgICAgICAgc2VnbWVudHMgPSBhcmdzLm4gPj0gNSBhbmQgZW5zdXJlX251bWVyaWMoYXJnc1s1XSwgIm1hdGguaW50ZWdyYWwgc2VnbWVudHMiKSBvciBuaWwKICAgICAgICBlbHNlaWYgdHlwZShhcmdzWzNdKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgbG93ZXIgPSBlbnN1cmVfbnVtZXJpYyhmaXJzdCwgIm1hdGguaW50ZWdyYWwgbG93ZXIiKQogICAgICAgICAgICB1cHBlciA9IGVuc3VyZV9udW1lcmljKGFyZ3NbMl0sICJtYXRoLmludGVncmFsIHVwcGVyIikKICAgICAgICAgICAgaW50ZWdyYW5kID0gYXJnc1szXQogICAgICAgICAgICBzZWdtZW50cyA9IGFyZ3MubiA+PSA0IGFuZCBlbnN1cmVfbnVtZXJpYyhhcmdzWzRdLCAibWF0aC5pbnRlZ3JhbCBzZWdtZW50cyIpIG9yIG5pbAogICAgICAgIGVsc2UKICAgICAgICAgICAgZXJyb3IoIm1hdGguaW50ZWdyYWw6IGV4cGVjdGVkIGludGVncmFuZCBmdW5jdGlvbiIpCiAgICAgICAgZW5kCgogICAgICAgIGlmIHR5cGUoaW50ZWdyYW5kKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguaW50ZWdyYWw6IGV4cGVjdGVkIGludGVncmFuZCBmdW5jdGlvbiIpCiAgICAgICAgZW5kCgogICAgICAgIHNlZ21lbnRzID0gc2VnbWVudHMgb3IgMTAwMAogICAgICAgIHNlZ21lbnRzID0gbWF0aC5tYXgoMSwgbWF0aC5mbG9vcihlbnN1cmVfbnVtZXJpYyhzZWdtZW50cywgIm1hdGguaW50ZWdyYWwgc2VnbWVudHMiKSkpCgogICAgICAgIGxvY2FsIHJhbmdlID0gdXBwZXIgLSBsb3dlcgogICAgICAgIGxvY2FsIHN0ZXAgPSByYW5nZSAvIHNlZ21lbnRzCiAgICAgICAgaWYgc3RlcCA9PSAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgYXJlYSA9IDAKICAgICAgICBsb2NhbCBwb3NpdGlvbiA9IGxvd2VyCgogICAgICAgIGZvciBfID0gMSwgc2VnbWVudHMgZG8KICAgICAgICAgICAgbG9jYWwgbWlkcG9pbnQgPSBwb3NpdGlvbiArIHN0ZXAgLyAyCiAgICAgICAgICAgIGxvY2FsIGhlaWdodCA9IGVuc3VyZV9udW1lcmljKGludGVncmFuZChtaWRwb2ludCksICJtYXRoLmludGVncmFsIGludGVncmFuZCByZXN1bHQiKQogICAgICAgICAgICBhcmVhID0gYXJlYSArIGhlaWdodCAqIHN0ZXAKICAgICAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiArIHN0ZXAKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIGFyZWEKICAgIGVuZAplbmQKCmxvY2FsIHN1bW1hdGlvbl9pbXBsID0gY3JlYXRlX3N1bW1hdGlvbl9pbXBsKCkKbG9jYWwgcHJvZHVjdF9pbXBsID0gY3JlYXRlX3Byb2R1Y3RfaW1wbCgpCmxvY2FsIGludGVncmFsX2ltcGwgPSBjcmVhdGVfaW50ZWdyYWxfaW1wbCgpCgppZiBub3QgbWF0aC5zdW1tYXRpb24gdGhlbgogICAgbWF0aC5zdW1tYXRpb24gPSBzdW1tYXRpb25faW1wbAplbmQKaWYgbm90IG1hdGgucHJvZHVjdCB0aGVuCiAgICBtYXRoLnByb2R1Y3QgPSBwcm9kdWN0X2ltcGwKZW5kCmlmIG5vdCBtYXRoLmludGVncmFsIHRoZW4KICAgIG1hdGguaW50ZWdyYWwgPSBpbnRlZ3JhbF9pbXBsCmVuZAoKLS0gTWF0aCBvYmplY3QgZm9yIEphdmFTY3JpcHQgY29tcGF0aWJpbGl0eQpydW50aW1lLk1hdGggPSB7fQoKbG9jYWwgZnVuY3Rpb24gbm9ybWFsaXplX3N0ZXAoc3RhcnRfdmFsdWUsIGVuZF92YWx1ZSwgc3RlcCkKICAgIGlmIHN0ZXAgPT0gbmlsIHRoZW4KICAgICAgICByZXR1cm4gc3RhcnRfdmFsdWUgPD0gZW5kX3ZhbHVlIGFuZCAxIG9yIC0xCiAgICBlbmQKICAgIGlmIHN0ZXAgPT0gMCB0aGVuCiAgICAgICAgZXJyb3IoIm1hdGggcmFuZ2Ugc3RlcCBjYW5ub3QgYmUgemVybyIpCiAgICBlbmQKICAgIHJldHVybiBzdGVwCmVuZAoKbG9jYWwgZnVuY3Rpb24gaXRlcmF0ZV9yYW5nZShzdGFydF92YWx1ZSwgZW5kX3ZhbHVlLCBzdGVwLCBoYW5kbGVyKQogICAgaWYgc3RlcCA9PSAwIHRoZW4KICAgICAgICBlcnJvcigibWF0aCByYW5nZSBzdGVwIGNhbm5vdCBiZSB6ZXJvIikKICAgIGVuZAogICAgbG9jYWwgaW5kZXggPSAwCiAgICBmb3IgdmFsdWUgPSBzdGFydF92YWx1ZSwgZW5kX3ZhbHVlLCBzdGVwIGRvCiAgICAgICAgaGFuZGxlcih2YWx1ZSwgaW5kZXgpCiAgICAgICAgaW5kZXggPSBpbmRleCArIDEKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHN1bW1hdGlvbl9pbXBsKGNvbGxlY3Rpb25fb3Jfc3RhcnQsIGZpbmlzaCwgc3RlcF9vcl9tYXBwZXIsIG1heWJlX21hcHBlcikKICAgIGxvY2FsIHRvdGFsID0gMAogICAgaWYgdHlwZShjb2xsZWN0aW9uX29yX3N0YXJ0KSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICBsb2NhbCBsb3dlciA9IGZpbmlzaAogICAgICAgIGxvY2FsIHVwcGVyID0gc3RlcF9vcl9tYXBwZXIKICAgICAgICBsb2NhbCBzdGVwID0gbWF5YmVfbWFwcGVyCgogICAgICAgIGlmIHR5cGUobG93ZXIpIH49ICJudW1iZXIiIG9yIHR5cGUodXBwZXIpIH49ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uIGV4cGVjdHMgbnVtZXJpYyBib3VuZHMgKGdvdCAiIC4uIHR5cGUobG93ZXIpIC4uICIsICIgLi4gdHlwZSh1cHBlcikgLi4gIikiKQogICAgICAgIGVuZAogICAgICAgIGlmIHN0ZXAgfj0gbmlsIGFuZCB0eXBlKHN0ZXApIH49ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uIHN0ZXAgbXVzdCBiZSBhIG51bWJlciIpCiAgICAgICAgZW5kCgogICAgICAgIHN0ZXAgPSBub3JtYWxpemVfc3RlcChsb3dlciwgdXBwZXIsIHN0ZXApCgogICAgICAgIGlmIChzdGVwID4gMCBhbmQgbG93ZXIgPiB1cHBlcikgb3IgKHN0ZXAgPCAwIGFuZCBsb3dlciA8IHVwcGVyKSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0b3RhbAogICAgICAgIGVuZAoKICAgICAgICBpdGVyYXRlX3JhbmdlKGxvd2VyLCB1cHBlciwgc3RlcCwgZnVuY3Rpb24odmFsdWUsIGluZGV4KQogICAgICAgICAgICBsb2NhbCBtYXBwZWQgPSBjb2xsZWN0aW9uX29yX3N0YXJ0KHZhbHVlLCBpbmRleCkKICAgICAgICAgICAgaWYgbWFwcGVkIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICB0b3RhbCA9IHRvdGFsICsgbWFwcGVkCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICByZXR1cm4gdG90YWwKICAgIGVsc2VpZiB0eXBlKGNvbGxlY3Rpb25fb3Jfc3RhcnQpID09ICJ0YWJsZSIgdGhlbgogICAgICAgIGxvY2FsIG1hcHBlciA9IHN0ZXBfb3JfbWFwcGVyCiAgICAgICAgaWYgbWFwcGVyIH49IG5pbCBhbmQgdHlwZShtYXBwZXIpIH49ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5zdW1tYXRpb24gbWFwcGVyIG11c3QgYmUgYSBmdW5jdGlvbiIpCiAgICAgICAgZW5kCiAgICAgICAgZm9yIGluZGV4LCB2YWx1ZSBpbiBpcGFpcnMoY29sbGVjdGlvbl9vcl9zdGFydCkgZG8KICAgICAgICAgICAgaWYgbWFwcGVyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIG1hcHBlZCA9IG1hcHBlcih2YWx1ZSwgaW5kZXggLSAxLCBjb2xsZWN0aW9uX29yX3N0YXJ0KQogICAgICAgICAgICAgICAgaWYgbWFwcGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IHRvdGFsICsgbWFwcGVkCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdG90YWwgPSB0b3RhbCArICh2YWx1ZSBvciAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gdG90YWwKICAgIGVsc2VpZiB0eXBlKGNvbGxlY3Rpb25fb3Jfc3RhcnQpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgIGxvY2FsIG1hcHBlciA9IGNvbGxlY3Rpb25fb3Jfc3RhcnQKICAgICAgICBpZiB0eXBlKGZpbmlzaCkgfj0gIm51bWJlciIgb3IgdHlwZShzdGVwX29yX21hcHBlcikgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5zdW1tYXRpb24gZXhwZWN0cyBudW1lcmljIGJvdW5kcyB3aGVuIGNhbGxiYWNrIGlzIGZpcnN0IGFyZ3VtZW50IikKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbG93ZXIgPSBlbnN1cmVfbnVtZXJpYyhmaW5pc2gsICJtYXRoLnN1bW1hdGlvbiBsb3dlciIpCiAgICAgICAgbG9jYWwgdXBwZXIgPSBlbnN1cmVfbnVtZXJpYyhzdGVwX29yX21hcHBlciwgIm1hdGguc3VtbWF0aW9uIHVwcGVyIikKICAgICAgICBsb2NhbCBzdGVwCgogICAgICAgIGlmIG1heWJlX21hcHBlciB+PSBuaWwgdGhlbgogICAgICAgICAgICBpZiB0eXBlKG1heWJlX21hcHBlcikgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uIHN0ZXAgbXVzdCBiZSBhIG51bWJlciIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAobG93ZXIsIHVwcGVyLCBlbnN1cmVfbnVtZXJpYyhtYXliZV9tYXBwZXIsICJtYXRoLnN1bW1hdGlvbiBzdGVwIikpCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAobG93ZXIsIHVwcGVyKQogICAgICAgIGVuZAoKICAgICAgICBpdGVyYXRlX3JhbmdlKGxvd2VyLCB1cHBlciwgc3RlcCwgZnVuY3Rpb24odmFsdWUsIGluZGV4KQogICAgICAgICAgICBsb2NhbCBtYXBwZWQgPSBtYXBwZXIodmFsdWUsIGluZGV4KQogICAgICAgICAgICBpZiBtYXBwZWQgdGhlbgogICAgICAgICAgICAgICAgdG90YWwgPSB0b3RhbCArIG1hcHBlZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCgogICAgICAgIHJldHVybiB0b3RhbAogICAgZWxzZWlmIHR5cGUoY29sbGVjdGlvbl9vcl9zdGFydCkgPT0gIm51bWJlciIgYW5kIHR5cGUoZmluaXNoKSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgbG9jYWwgc3RlcCwgbWFwcGVyCiAgICAgICAgaWYgdHlwZShzdGVwX29yX21hcHBlcikgPT0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAoY29sbGVjdGlvbl9vcl9zdGFydCwgZmluaXNoLCBzdGVwX29yX21hcHBlcikKICAgICAgICAgICAgbWFwcGVyID0gbWF5YmVfbWFwcGVyCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAoY29sbGVjdGlvbl9vcl9zdGFydCwgZmluaXNoKQogICAgICAgICAgICBtYXBwZXIgPSBzdGVwX29yX21hcHBlcgogICAgICAgIGVuZAogICAgICAgIGlmIG1hcHBlciB+PSBuaWwgYW5kIHR5cGUobWFwcGVyKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uIG1hcHBlciBtdXN0IGJlIGEgZnVuY3Rpb24iKQogICAgICAgIGVuZAogICAgICAgIG1hcHBlciA9IG1hcHBlciBvciBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgZW5kCiAgICAgICAgaWYgc3RlcCA+IDAgYW5kIGNvbGxlY3Rpb25fb3Jfc3RhcnQgPiBmaW5pc2ggdGhlbgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGVuZAogICAgICAgIGlmIHN0ZXAgPCAwIGFuZCBjb2xsZWN0aW9uX29yX3N0YXJ0IDwgZmluaXNoIHRoZW4KICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBlbmQKICAgICAgICBpdGVyYXRlX3JhbmdlKGNvbGxlY3Rpb25fb3Jfc3RhcnQsIGZpbmlzaCwgc3RlcCwgZnVuY3Rpb24odmFsdWUsIGluZGV4KQogICAgICAgICAgICBsb2NhbCBtYXBwZWQgPSBtYXBwZXIodmFsdWUsIGluZGV4KQogICAgICAgICAgICBpZiBtYXBwZWQgdGhlbgogICAgICAgICAgICAgICAgdG90YWwgPSB0b3RhbCArIG1hcHBlZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgcmV0dXJuIHRvdGFsCiAgICBlbmQKICAgIGVycm9yKCJtYXRoLnN1bW1hdGlvbiBleHBlY3RzIGEgdGFibGUgb3IgbnVtZXJpYyByYW5nZSIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gcHJvZHVjdF9pbXBsKGNvbGxlY3Rpb25fb3Jfc3RhcnQsIGZpbmlzaCwgc3RlcF9vcl9tYXBwZXIsIG1heWJlX21hcHBlcikKICAgIGxvY2FsIHJlc3VsdCA9IDEKICAgIGlmIHR5cGUoY29sbGVjdGlvbl9vcl9zdGFydCkgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgbG9jYWwgbG93ZXIgPSBmaW5pc2gKICAgICAgICBsb2NhbCB1cHBlciA9IHN0ZXBfb3JfbWFwcGVyCiAgICAgICAgbG9jYWwgc3RlcCA9IG1heWJlX21hcHBlcgoKICAgICAgICBpZiB0eXBlKGxvd2VyKSB+PSAibnVtYmVyIiBvciB0eXBlKHVwcGVyKSB+PSAibnVtYmVyIiB0aGVuCiAgICAgICAgICAgIGVycm9yKCJtYXRoLnByb2R1Y3QgZXhwZWN0cyBudW1lcmljIGJvdW5kcyAoZ290ICciIC4uIHR5cGUobG93ZXIpIC4uICInLCAnIiAuLiB0eXBlKHVwcGVyKSAuLiAiJykiKQogICAgICAgIGVuZAogICAgICAgIGlmIHN0ZXAgfj0gbmlsIGFuZCB0eXBlKHN0ZXApIH49ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGgucHJvZHVjdCBzdGVwIG11c3QgYmUgYSBudW1iZXIiKQogICAgICAgIGVuZAoKICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAobG93ZXIsIHVwcGVyLCBzdGVwKQoKICAgICAgICBpZiAoc3RlcCA+IDAgYW5kIGxvd2VyID4gdXBwZXIpIG9yIChzdGVwIDwgMCBhbmQgbG93ZXIgPCB1cHBlcikgdGhlbgogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZW5kCgogICAgICAgIGl0ZXJhdGVfcmFuZ2UobG93ZXIsIHVwcGVyLCBzdGVwLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpCiAgICAgICAgICAgIGxvY2FsIG1hcHBlZCA9IGNvbGxlY3Rpb25fb3Jfc3RhcnQodmFsdWUsIGluZGV4KQogICAgICAgICAgICBpZiBtYXBwZWQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCAqIG1hcHBlZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgZWxzZWlmIHR5cGUoY29sbGVjdGlvbl9vcl9zdGFydCkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgbG9jYWwgbWFwcGVyID0gc3RlcF9vcl9tYXBwZXIKICAgICAgICBpZiBtYXBwZXIgfj0gbmlsIGFuZCB0eXBlKG1hcHBlcikgfj0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIGVycm9yKCJtYXRoLnByb2R1Y3QgbWFwcGVyIG11c3QgYmUgYSBmdW5jdGlvbiIpCiAgICAgICAgZW5kCiAgICAgICAgZm9yIGluZGV4LCB2YWx1ZSBpbiBpcGFpcnMoY29sbGVjdGlvbl9vcl9zdGFydCkgZG8KICAgICAgICAgICAgbG9jYWwgbWFwcGVkCiAgICAgICAgICAgIGlmIG1hcHBlciB0aGVuCiAgICAgICAgICAgICAgICBtYXBwZWQgPSBtYXBwZXIodmFsdWUsIGluZGV4IC0gMSwgY29sbGVjdGlvbl9vcl9zdGFydCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWFwcGVkID0gdmFsdWUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIG1hcHBlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICogbWFwcGVkCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHJldHVybiByZXN1bHQKICAgIGVsc2VpZiB0eXBlKGNvbGxlY3Rpb25fb3Jfc3RhcnQpID09ICJudW1iZXIiIGFuZCB0eXBlKGZpbmlzaCkgPT0gIm51bWJlciIgdGhlbgogICAgICAgIGxvY2FsIHN0ZXAsIG1hcHBlcgogICAgICAgIGlmIHR5cGUoc3RlcF9vcl9tYXBwZXIpID09ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgc3RlcCA9IG5vcm1hbGl6ZV9zdGVwKGNvbGxlY3Rpb25fb3Jfc3RhcnQsIGZpbmlzaCwgc3RlcF9vcl9tYXBwZXIpCiAgICAgICAgICAgIG1hcHBlciA9IG1heWJlX21hcHBlcgogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RlcCA9IG5vcm1hbGl6ZV9zdGVwKGNvbGxlY3Rpb25fb3Jfc3RhcnQsIGZpbmlzaCkKICAgICAgICAgICAgbWFwcGVyID0gc3RlcF9vcl9tYXBwZXIKICAgICAgICBlbmQKICAgICAgICBpZiBtYXBwZXIgfj0gbmlsIGFuZCB0eXBlKG1hcHBlcikgfj0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIGVycm9yKCJtYXRoLnByb2R1Y3QgbWFwcGVyIG11c3QgYmUgYSBmdW5jdGlvbiIpCiAgICAgICAgZW5kCiAgICAgICAgbWFwcGVyID0gbWFwcGVyIG9yIGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICBlbmQKICAgICAgICBpZiBzdGVwID4gMCBhbmQgY29sbGVjdGlvbl9vcl9zdGFydCA+IGZpbmlzaCB0aGVuCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgZW5kCiAgICAgICAgaWYgc3RlcCA8IDAgYW5kIGNvbGxlY3Rpb25fb3Jfc3RhcnQgPCBmaW5pc2ggdGhlbgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgIGVuZAogICAgICAgIGl0ZXJhdGVfcmFuZ2UoY29sbGVjdGlvbl9vcl9zdGFydCwgZmluaXNoLCBzdGVwLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpCiAgICAgICAgICAgIGxvY2FsIG1hcHBlZCA9IG1hcHBlcih2YWx1ZSwgaW5kZXgpCiAgICAgICAgICAgIGlmIG1hcHBlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICogbWFwcGVkCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICBlbmQKICAgIGVycm9yKCJtYXRoLnByb2R1Y3QgZXhwZWN0cyBhIHRhYmxlIG9yIG51bWVyaWMgcmFuZ2UiKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGludGVncmFsX2ltcGwoZm4sIGEsIGIsIHN0ZXBzKQogICAgaWYgdHlwZShmbikgfj0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgZXJyb3IoIm1hdGguaW50ZWdyYWwgcmVxdWlyZXMgYSBmdW5jdGlvbiBhcyB0aGUgZmlyc3QgYXJndW1lbnQiKQogICAgZW5kCiAgICBpZiB0eXBlKGEpIH49ICJudW1iZXIiIG9yIHR5cGUoYikgfj0gIm51bWJlciIgdGhlbgogICAgICAgIGVycm9yKCJtYXRoLmludGVncmFsIHJlcXVpcmVzIG51bWVyaWMgYm91bmRzIikKICAgIGVuZAogICAgc3RlcHMgPSBzdGVwcyBvciAxMDAwCiAgICBpZiBzdGVwcyA8PSAwIHRoZW4KICAgICAgICByZXR1cm4gMAogICAgZW5kCiAgICBsb2NhbCBkaXJlY3Rpb24gPSAxCiAgICBpZiBiIDwgYSB0aGVuCiAgICAgICAgYSwgYiA9IGIsIGEKICAgICAgICBkaXJlY3Rpb24gPSAtMQogICAgZW5kCiAgICBsb2NhbCBzdGVwID0gKGIgLSBhKSAvIHN0ZXBzCiAgICBsb2NhbCB0b3RhbCA9IDAuNSAqIChmbihhKSArIGZuKGIpKQogICAgZm9yIGkgPSAxLCBzdGVwcyAtIDEgZG8KICAgICAgICBsb2NhbCB4ID0gYSArIHN0ZXAgKiBpCiAgICAgICAgdG90YWwgPSB0b3RhbCArIGZuKHgpCiAgICBlbmQKICAgIHJldHVybiB0b3RhbCAqIHN0ZXAgKiBkaXJlY3Rpb24KZW5kCgppZiBub3QgbWF0aC5zdW1tYXRpb24gdGhlbgogICAgbWF0aC5zdW1tYXRpb24gPSBzdW1tYXRpb25faW1wbAplbmQKaWYgbm90IG1hdGgucHJvZHVjdCB0aGVuCiAgICBtYXRoLnByb2R1Y3QgPSBwcm9kdWN0X2ltcGwKZW5kCmlmIG5vdCBtYXRoLmludGVncmFsIHRoZW4KICAgIG1hdGguaW50ZWdyYWwgPSBpbnRlZ3JhbF9pbXBsCmVuZAoKcnVudGltZS5NYXRoLnN1bW1hdGlvbiA9IHN1bW1hdGlvbl9pbXBsCnJ1bnRpbWUuTWF0aC5wcm9kdWN0ID0gcHJvZHVjdF9pbXBsCnJ1bnRpbWUuTWF0aC5pbnRlZ3JhbCA9IGludGVncmFsX2ltcGwKcnVudGltZS5NYXRoLlBJID0gbWF0aC5waQpydW50aW1lLk1hdGguRSA9IG1hdGguZXhwKDEpCnJ1bnRpbWUuTWF0aC5zdW1tYXRpb24gPSBtYXRoLnN1bW1hdGlvbgpydW50aW1lLk1hdGgucHJvZHVjdCA9IG1hdGgucHJvZHVjdApydW50aW1lLk1hdGguaW50ZWdyYWwgPSBtYXRoLmludGVncmFsCmZ1bmN0aW9uIHJ1bnRpbWUuTWF0aC5hYnMoeCkKICAgIHJldHVybiBtYXRoLmFicyh4KQplbmQKZnVuY3Rpb24gcnVudGltZS5NYXRoLmNlaWwoeCkKICAgIHJldHVybiBtYXRoLmNlaWwoeCkKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuTWF0aC5mbG9vcih4KQogICAgcmV0dXJuIG1hdGguZmxvb3IoeCkKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuTWF0aC5tYXgoLi4uKQogICAgcmV0dXJuIG1hdGgubWF4KC4uLikKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuTWF0aC5taW4oLi4uKQogICAgcmV0dXJuIG1hdGgubWluKC4uLikKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuTWF0aC5wb3coeCwgeSkKICAgIHJldHVybiBtYXRoLnBvdyh4LCB5KQplbmQKZnVuY3Rpb24gcnVudGltZS5NYXRoLnJhbmRvbSgpCiAgICByZXR1cm4gbWF0aC5yYW5kb20oKQplbmQKZnVuY3Rpb24gcnVudGltZS5NYXRoLnJvdW5kKHgpCiAgICByZXR1cm4gbWF0aC5mbG9vcih4ICsgMC41KQplbmQKZnVuY3Rpb24gcnVudGltZS5NYXRoLnNxcnQoeCkKICAgIHJldHVybiBtYXRoLnNxcnQoeCkKZW5kCgotLSBFeHRlbmRlZCBMdWEgbWF0aCBoZWxwZXJzIGZvciBVbmljb2RlIG9wZXJhdG9ycwpsb2NhbCBmdW5jdGlvbiBlbnN1cmVfY2FsbGJhY2soY2FsbGJhY2ssIG5hbWUpCiAgICBpZiB0eXBlKGNhbGxiYWNrKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICBlcnJvcihuYW1lIC4uICIgZXhwZWN0cyBhIGZ1bmN0aW9uIGFzIHRoZSBmaXJzdCBhcmd1bWVudCIsIDIpCiAgICBlbmQKICAgIHJldHVybiBjYWxsYmFjawplbmQKCmxvY2FsIGZ1bmN0aW9uIG5vcm1hbGl6ZV9zdGVwKGxvd2VyLCB1cHBlciwgc3RlcCkKICAgIGlmIHN0ZXAgPT0gbmlsIHRoZW4KICAgICAgICBpZiBsb3dlciA8PSB1cHBlciB0aGVuCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgc3RlcCA9PSAwIHRoZW4KICAgICAgICBlcnJvcigic3RlcCBtdXN0IG5vdCBiZSB6ZXJvIiwgMikKICAgIGVuZAogICAgcmV0dXJuIHN0ZXAKZW5kCgppZiB0eXBlKG1hdGgucHJvZHVjdCkgfj0gImZ1bmN0aW9uIiB0aGVuCiAgICBmdW5jdGlvbiBtYXRoLnByb2R1Y3QoY2FsbGJhY2ssIGxvd2VyLCB1cHBlciwgc3RlcCkKICAgICAgICBjYWxsYmFjayA9IGVuc3VyZV9jYWxsYmFjayhjYWxsYmFjaywgIm1hdGgucHJvZHVjdCIpCiAgICAgICAgaWYgdHlwZShsb3dlcikgfj0gIm51bWJlciIgb3IgdHlwZSh1cHBlcikgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5wcm9kdWN0IGV4cGVjdHMgbnVtZXJpYyBib3VuZHMiLCAyKQogICAgICAgIGVuZAoKICAgICAgICBzdGVwID0gbm9ybWFsaXplX3N0ZXAobG93ZXIsIHVwcGVyLCBzdGVwKQogICAgICAgIGxvY2FsIHJlc3VsdCA9IDEKCiAgICAgICAgaWYgKHN0ZXAgPiAwIGFuZCBsb3dlciA+IHVwcGVyKSBvciAoc3RlcCA8IDAgYW5kIGxvd2VyIDwgdXBwZXIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGVuZAoKICAgICAgICBmb3IgdmFsdWUgPSBsb3dlciwgdXBwZXIsIHN0ZXAgZG8KICAgICAgICAgICAgbG9jYWwgdGVybSA9IGNhbGxiYWNrKHZhbHVlKQogICAgICAgICAgICBpZiB0eXBlKHRlcm0pIH49ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgICAgIGVycm9yKCJtYXRoLnByb2R1Y3QgY2FsbGJhY2sgbXVzdCByZXR1cm4gYSBudW1iZXIiLCAyKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICogdGVybQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICBlbmQKZW5kCgppZiB0eXBlKG1hdGguc3VtbWF0aW9uKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgIGZ1bmN0aW9uIG1hdGguc3VtbWF0aW9uKGNhbGxiYWNrLCBsb3dlciwgdXBwZXIsIHN0ZXApCiAgICAgICAgY2FsbGJhY2sgPSBlbnN1cmVfY2FsbGJhY2soY2FsbGJhY2ssICJtYXRoLnN1bW1hdGlvbiIpCiAgICAgICAgaWYgdHlwZShsb3dlcikgfj0gIm51bWJlciIgb3IgdHlwZSh1cHBlcikgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBlcnJvcigibWF0aC5zdW1tYXRpb24gZXhwZWN0cyBudW1lcmljIGJvdW5kcyIsIDIpCiAgICAgICAgZW5kCgogICAgICAgIHN0ZXAgPSBub3JtYWxpemVfc3RlcChsb3dlciwgdXBwZXIsIHN0ZXApCiAgICAgICAgbG9jYWwgcmVzdWx0ID0gMAoKICAgICAgICBpZiAoc3RlcCA+IDAgYW5kIGxvd2VyID4gdXBwZXIpIG9yIChzdGVwIDwgMCBhbmQgbG93ZXIgPCB1cHBlcikgdGhlbgogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZW5kCgogICAgICAgIGZvciB2YWx1ZSA9IGxvd2VyLCB1cHBlciwgc3RlcCBkbwogICAgICAgICAgICBsb2NhbCB0ZXJtID0gY2FsbGJhY2sodmFsdWUpCiAgICAgICAgICAgIGlmIHR5cGUodGVybSkgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICAgICAgZXJyb3IoIm1hdGguc3VtbWF0aW9uIGNhbGxiYWNrIG11c3QgcmV0dXJuIGEgbnVtYmVyIiwgMikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCArIHRlcm0KICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgZW5kCmVuZAoKaWYgdHlwZShtYXRoLmludGVncmFsKSB+PSAiZnVuY3Rpb24iIHRoZW4KICAgIGZ1bmN0aW9uIG1hdGguaW50ZWdyYWwoY2FsbGJhY2ssIGxvd2VyLCB1cHBlciwgc3RlcHMpCiAgICAgICAgY2FsbGJhY2sgPSBlbnN1cmVfY2FsbGJhY2soY2FsbGJhY2ssICJtYXRoLmludGVncmFsIikKICAgICAgICBpZiB0eXBlKGxvd2VyKSB+PSAibnVtYmVyIiBvciB0eXBlKHVwcGVyKSB+PSAibnVtYmVyIiB0aGVuCiAgICAgICAgICAgIGVycm9yKCJtYXRoLmludGVncmFsIGV4cGVjdHMgbnVtZXJpYyBib3VuZHMiLCAyKQogICAgICAgIGVuZAoKICAgICAgICBzdGVwcyA9IHN0ZXBzIG9yIDEwMDAKICAgICAgICBpZiB0eXBlKHN0ZXBzKSB+PSAibnVtYmVyIiBvciBzdGVwcyA8PSAwIHRoZW4KICAgICAgICAgICAgZXJyb3IoIm1hdGguaW50ZWdyYWwgZXhwZWN0cyBhIHBvc2l0aXZlIG51bWJlciBvZiBzdGVwcyIsIDIpCiAgICAgICAgZW5kCgogICAgICAgIGlmIGxvd2VyID09IHVwcGVyIHRoZW4KICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3RhcnQgPSBsb3dlcgogICAgICAgIGxvY2FsIGZpbmlzaCA9IHVwcGVyCiAgICAgICAgbG9jYWwgZGlyZWN0aW9uID0gMQogICAgICAgIGlmIHVwcGVyIDwgbG93ZXIgdGhlbgogICAgICAgICAgICBzdGFydCA9IHVwcGVyCiAgICAgICAgICAgIGZpbmlzaCA9IGxvd2VyCiAgICAgICAgICAgIGRpcmVjdGlvbiA9IC0xCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHN0ZXBfc2l6ZSA9IChmaW5pc2ggLSBzdGFydCkgLyBzdGVwcwoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBldmFsdWF0ZShwb2ludCkKICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSBjYWxsYmFjayhwb2ludCkKICAgICAgICAgICAgaWYgdHlwZSh2YWx1ZSkgfj0gIm51bWJlciIgdGhlbgogICAgICAgICAgICAgICAgZXJyb3IoIm1hdGguaW50ZWdyYWwgY2FsbGJhY2sgbXVzdCByZXR1cm4gYSBudW1iZXIiLCAyKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHN1bSA9IDAuNSAqIChldmFsdWF0ZShzdGFydCkgKyBldmFsdWF0ZShmaW5pc2gpKQoKICAgICAgICBmb3IgaSA9IDEsIHN0ZXBzIC0gMSBkbwogICAgICAgICAgICBsb2NhbCB4ID0gc3RhcnQgKyBzdGVwX3NpemUgKiBpCiAgICAgICAgICAgIHN1bSA9IHN1bSArIGV2YWx1YXRlKHgpCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBzdW0gKiBzdGVwX3NpemUgKiBkaXJlY3Rpb24KICAgIGVuZAplbmQKLS0gU3RyaW5nIHByb3RvdHlwZSBtZXRob2RzCnJ1bnRpbWUuU3RyaW5nID0ge30KZnVuY3Rpb24gcnVudGltZS5TdHJpbmcuY2hhckF0KHN0ciwgaW5kZXgpCiAgICByZXR1cm4gc3RyOnN1YihpbmRleCArIDEsIGluZGV4ICsgMSkKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuU3RyaW5nLmluZGV4T2Yoc3RyLCBzZWFyY2hWYWx1ZSwgZnJvbUluZGV4KQogICAgZnJvbUluZGV4ID0gZnJvbUluZGV4IG9yIDAKICAgIGxvY2FsIHBvcyA9IHN0cjpmaW5kKHNlYXJjaFZhbHVlLCBmcm9tSW5kZXggKyAxLCB0cnVlKQogICAgcmV0dXJuIHBvcyBhbmQgKHBvcyAtIDEpIG9yIC0xCmVuZApmdW5jdGlvbiBydW50aW1lLlN0cmluZy5zdWJzdHJpbmcoc3RyLCBzdGFydCwgc3RvcCkKICAgIHN0YXJ0ID0gc3RhcnQgb3IgMAogICAgc3RvcCA9IHN0b3Agb3IgI3N0cgogICAgcmV0dXJuIHN0cjpzdWIoc3RhcnQgKyAxLCBzdG9wKQplbmQKZnVuY3Rpb24gcnVudGltZS5TdHJpbmcudG9Mb3dlckNhc2Uoc3RyKQogICAgcmV0dXJuIHN0cjpsb3dlcigpCmVuZApmdW5jdGlvbiBydW50aW1lLlN0cmluZy50b1VwcGVyQ2FzZShzdHIpCiAgICByZXR1cm4gc3RyOnVwcGVyKCkKZW5kCi0tIEFycmF5IHByb3RvdHlwZSBtZXRob2RzCnJ1bnRpbWUuQXJyYXkgPSB7fQpmdW5jdGlvbiBydW50aW1lLkFycmF5LnB1c2goYXJyLCAuLi4pCiAgICBsb2NhbCBhcmdzID0gey4uLn0KICAgIGZvciBfLCB2IGluIGlwYWlycyhhcmdzKSBkbwogICAgICAgIHRhYmxlLmluc2VydChhcnIsIHYpCiAgICBlbmQKICAgIHJldHVybiAjYXJyCmVuZApmdW5jdGlvbiBydW50aW1lLkFycmF5LnBvcChhcnIpCiAgICByZXR1cm4gdGFibGUucmVtb3ZlKGFycikKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuQXJyYXkuc2hpZnQoYXJyKQogICAgcmV0dXJuIHRhYmxlLnJlbW92ZShhcnIsIDEpCmVuZApmdW5jdGlvbiBydW50aW1lLkFycmF5LnVuc2hpZnQoYXJyLCAuLi4pCiAgICBsb2NhbCBhcmdzID0gey4uLn0KICAgIGZvciBpID0gI2FyZ3MsIDEsIC0xIGRvCiAgICAgICAgdGFibGUuaW5zZXJ0KGFyciwgMSwgYXJnc1tpXSkKICAgIGVuZAogICAgcmV0dXJuICNhcnIKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuQXJyYXkuam9pbihhcnIsIHNlcGFyYXRvcikKICAgIHNlcGFyYXRvciA9IHNlcGFyYXRvciBvciAiLCIKICAgIHJldHVybiB0YWJsZS5jb25jYXQoYXJyLCBzZXBhcmF0b3IpCmVuZAotLSBHbG9iYWwgZnVuY3Rpb25zCmZ1bmN0aW9uIHJ1bnRpbWUucGFyc2VJbnQoc3RyLCByYWRpeCkKICAgIHJhZGl4ID0gcmFkaXggb3IgMTAKICAgIHJldHVybiB0b251bWJlcihzdHIsIHJhZGl4KQplbmQKZnVuY3Rpb24gcnVudGltZS5wYXJzZUZsb2F0KHN0cikKICAgIHJldHVybiB0b251bWJlcihzdHIpCmVuZApmdW5jdGlvbiBydW50aW1lLmlzTmFOKHZhbHVlKQogICAgcmV0dXJuIHZhbHVlIH49IHZhbHVlCmVuZApmdW5jdGlvbiBydW50aW1lLmlzRmluaXRlKHZhbHVlKQogICAgcmV0dXJuIHR5cGUodmFsdWUpID09ICJudW1iZXIiIGFuZCB2YWx1ZSA9PSB2YWx1ZSBhbmQgdmFsdWUgfj0gbWF0aC5odWdlIGFuZCB2YWx1ZSB+PSAtbWF0aC5odWdlCmVuZAotLSBzZXRUaW1lb3V0IGFuZCBzZXRJbnRlcnZhbCAoYmFzaWMgaW1wbGVtZW50YXRpb24pCnJ1bnRpbWUudGltZXJzID0ge30KcnVudGltZS50aW1lcl9pZCA9IDAKZnVuY3Rpb24gcnVudGltZS5zZXRUaW1lb3V0KGNhbGxiYWNrLCBkZWxheSkKICAgIHJ1bnRpbWUudGltZXJfaWQgPSBydW50aW1lLnRpbWVyX2lkICsgMQogICAgbG9jYWwgaWQgPSBydW50aW1lLnRpbWVyX2lkCiAgICAtLSBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdXNlIHByb3BlciBhc3luYyB0aW1lcnMKICAgIC0tIEZvciBub3csIHRoaXMgaXMgYSBwbGFjZWhvbGRlcgogICAgcnVudGltZS50aW1lcnNbaWRdID0gewogICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2ssCiAgICAgICAgZGVsYXkgPSBkZWxheSwKICAgICAgICB0eXBlID0gInRpbWVvdXQiCiAgICB9CiAgICByZXR1cm4gaWQKZW5kCmZ1bmN0aW9uIHJ1bnRpbWUuY2xlYXJUaW1lb3V0KGlkKQogICAgcnVudGltZS50aW1lcnNbaWRdID0gbmlsCmVuZApyZXR1cm4gcnVudGltZQo=",
  "encoding": "base64",
  "_links": {
    "self": "https://api.github.com/repos/ssdajoker/LUASCRIPT/contents/runtime/runtime.lua?ref=fix/runtime-compat-phase1B",
    "git": "https://api.github.com/repos/ssdajoker/LUASCRIPT/git/blobs/5416866255403d69860f82dd7e3d955ad6238685",
    "html": "https://github.com/ssdajoker/LUASCRIPT/blob/fix/runtime-compat-phase1B/runtime/runtime.lua"
  }
}